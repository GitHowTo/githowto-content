---
view: page
title: "17. Удаление коммитов из ветки"
---

<h3>Цели</h3>

<ul><li>Научиться удалять самые последние коммиты из ветки</li></ul>

<p><code>Revert</code> из предыдущего раздела является мощной командой, которая позволяет отменить любые коммиты в репозиторий. Однако, и оригинальный и «отмененный» коммиты видны в истории ветки (при использовании команды <code>git log</code>).</p>

<p>Часто мы делаем коммит, и сразу понимаем, что это была ошибка. Было бы неплохо иметь команду «возврата», которая позволила бы нам сделать вид, что неправильного коммита никогда и не было. Команда «возврата» даже предотвратила бы появление нежелательного коммита в истории <code>git log</code>.</p>

<h2><em>01</em> Команда <code>reset</code></h2>

<p>Мы уже видели команду <code>reset</code> и использовали ее для согласования буферной зоны и выбранного коммита (мы использовали коммит <span class="caps">HEAD</span> в нашем предыдущем уроке).</p>
<p>При получении ссылки на коммит (т.е. хэш, ветка или имя тега), команда <code>reset</code>…</p>

<ol>
<li>Перепишет текущую ветку, чтобы она указывала на нужный коммит</li>
<li>Опционально сбросит буферную зону для соответствия с указанным коммитом</li>
<li>Опционально сбросит рабочий каталог для соответствия с указанным коммитом</li>
</ol>

<h2><em>02</em> Проверьте нашу историю</h2>

<p>Давайте сделаем быструю проверку нашей истории коммитов.</p>

<h4 class="h4-pre">Выполните:</h4>

<pre class="instructions">git hist</pre>

<h4 class="h4-pre">Результат:</h4>

<pre class="sample">$ git hist
* 45fa96b 2011-03-09 | Revert "Oops, we didn't want this commit" (HEAD, master) [Alexander Shvets]
* 846b90c 2011-03-09 | Oops, we didn't want this commit [Alexander Shvets]
* fa3c141 2011-03-09 | Added HTML header (v1) [Alexander Shvets]
* 8c32287 2011-03-09 | Added standard HTML page tags (v1-beta) [Alexander Shvets]
* 43628f7 2011-03-09 | Added h1 tag [Alexander Shvets]
* 911e8c9 2011-03-09 | First Commit [Alexander Shvets]</pre>

<p>Мы видим, что два последних коммита в этой ветке - «Oops» и «Revert Oops». Давайте удалим их с помощью сброса.</p>

<h2><em>03</em> Для начала отметьте эту ветку</h2>

<p>Но прежде чем удалить коммиты, давайте отметим последний коммит тегом, чтобы потом можно было его найти.</p>

<h4 class="h4-pre">Выполните:</h4>

<pre class="instructions">git tag oops</pre>

<h2><em>04</em> Сброс коммитов к предшествующим коммиту Oops</h2>

<p>Глядя на историю лога (см. выше), мы видим, что коммит с тегом «v1» является коммитом, предшествующим ошибочному коммиту. Давайте сбросим ветку до этой точки. Поскольку ветка имеет тег, мы можем использовать имя тега в команде сброса (если она не имеет тега, мы можем использовать хэш-значение).</p>

<h4 class="h4-pre">Выполните:</h4>

<pre class="instructions">git reset --hard v1
git hist</pre>

<h4 class="h4-pre">Результат:</h4>

<pre class="sample">$ git reset --hard v1
HEAD is now at fa3c141 Added HTML header
$ git hist
* fa3c141 2011-03-09 | Added HTML header (HEAD, v1, master) [Alexander Shvets]
* 8c32287 2011-03-09 | Added standard HTML page tags (v1-beta) [Alexander Shvets]
* 43628f7 2011-03-09 | Added h1 tag [Alexander Shvets]
* 911e8c9 2011-03-09 | First Commit [Alexander Shvets]</pre>

<p>Наша ветка master теперь указывает на коммит v1, а коммитов Oops и Revert Oops в ветке уже нет. Параметр <code>--hard</code> указывает, что рабочий каталог должен быть обновлен в соответствии с новым head ветки.</p>
<h2><em>05</em> Ничего никогда не теряется</h2>

<p>Что же случается с ошибочными коммитами? Оказывается, что коммиты все еще находятся в репозитории. На самом деле, мы все еще можем на них ссылаться. Помните, в начале этого урока мы создали для отмененного коммита тег «oops». Давайте посмотрим на <em>все</em> коммиты.</p>

<h4 class="h4-pre">Выполните:</h4>

<pre class="instructions">git hist --all</pre>

<h4 class="h4-pre">Результат:</h4>

<pre class="sample">$ git hist --all
* 45fa96b 2011-03-09 | Revert "Oops, we didn't want this commit" (oops) [Alexander Shvets]
* 846b90c 2011-03-09 | Oops, we didn't want this commit [Alexander Shvets]
* fa3c141 2011-03-09 | Added HTML header (HEAD, v1, master) [Alexander Shvets]
* 8c32287 2011-03-09 | Added standard HTML page tags (v1-beta) [Alexander Shvets]
* 43628f7 2011-03-09 | Added h1 tag [Alexander Shvets]
* 911e8c9 2011-03-09 | First Commit [Alexander Shvets]</pre>

<p>Мы видим, что ошибочные коммиты не исчезли. Они все еще находятся в репозитории. Просто они отсутствуют в ветке <code>master</code>. Если бы мы не отметили их тегами, они по-прежнему находились бы в репозитории, но не было бы никакой возможности ссылаться на них, кроме как при помощи их хэш имен. Коммиты, на которые нет ссылок, остаются в репозитории до тех пор, пока не будет запущен сборщик мусора.</p>

<h2><em>06</em> Опасность сброса</h2>

<p>Сброс в локальных ветках, как правило, безопасен. Последствия любой «аварии» как правило, можно восстановить простым сбросом с помощью нужного коммита.</p>

<p>Однако, если ветка «расшарена» на удаленных репозиториях, сброс может сбить с толку других пользователей ветки.</p>